from src.dataProvider.container.mySTIXContainer.AttackPatternsContainer import AttackPatternsContainer
import tiktoken

"""
messages = []

for at in [at for at in AttackPatternsContainer().get_tuple_data() if 'enterprise-attack' in at.x_mitre_domains]:
            json_data = {
                "role": "system",
                "content": "You are a chatbot specializing in the context of cybersecurity, the attack pattern known with the id \'" 
                    + at.x_mitre_id + "\' is: " + at.name + ' .'
            }

            messages.append(json_data)
"""
message = "You are a cybersecurity chatbot. You are an expert in identifying and explaining various cybersecurity attack patterns. Here is a list of attack patterns along with their IDs that you are familiar with:"

for at in [at for at in AttackPatternsContainer().get_tuple_data() if 'enterprise-attack' in at.x_mitre_domains]:
    message += (at.x_mitre_id + ":" + at.name + '\n')
    
json_data = [{
            "role": "system",
            "content": message}]

#print(messages)
encoding = tiktoken.encoding_for_model('gpt-3.5-turbo')

prompt_text = ''
for message in json_data:
    prompt_text += message['role'] + ': ' + message['content'] + '\n'

tokens = encoding.encode(prompt_text)
num_tokens = len(tokens)

print(f'The prompt contains {num_tokens} tokens.')