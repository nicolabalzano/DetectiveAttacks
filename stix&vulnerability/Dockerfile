FROM python:3.10-slim

WORKDIR /stix&vulnerability

COPY ./requirements.txt .

RUN apt-get update && apt-get install -y git 
RUN apt-get install -y xfonts-75dpi wget
RUN apt-get -y install libjpeg62-turbo-dev
RUN wget http://snapshot.debian.org/archive/debian/20190501T215844Z/pool/main/g/glibc/multiarch-support_2.28-10_amd64.deb
RUN dpkg -i multiarch-support_2.28-10_amd64.deb
RUN rm ./multiarch-support_2.28-10_amd64.deb
RUN wget http://snapshot.debian.org/archive/debian/20170705T160707Z/pool/main/o/openssl/libssl1.0.0_1.0.2l-1%7Ebpo8%2B1_amd64.deb
RUN dpkg -i libssl1.0.0_1.0.2l-1~bpo8+1_amd64.deb
RUN rm ./libssl1.0.0_1.0.2l-1~bpo8+1_amd64.deb
RUN wget https://github.com/wkhtmltopdf/packaging/releases/download/0.12.6.1-3/wkhtmltox_0.12.6.1-3.bookworm_amd64.deb
RUN apt install -y ./wkhtmltox_0.12.6.1-3.bookworm_amd64.deb
RUN rm ./wkhtmltox_0.12.6.1-3.bookworm_amd64.deb

RUN pip install -r requirements.txt

# ENV AZURE_OPENAI_API_KEY=a76fd807e235483c86ee29e522b499f9
ENV AZURE_OPENAI_ENDPOINT=https://cti-gpt-fine-tuned.openai.azure.com/

COPY . .

ENTRYPOINT [ "python" ]

CMD ["app.py"]
