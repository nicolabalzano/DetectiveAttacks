import json
import os
from src.dataProvider.utils.FileUtils import read_from_json
from src.dataProvider.interfaceToCTI.utils.Path import default_path, MAPPINGS_EXPLORER

class MappingsExplorerData:

    def __init__(self):
        self.__dict_file = read_from_json(default_path, MAPPINGS_EXPLORER)

    def get_all(self):
        return self.__dict_file['mapping_objects']
    
    def get_at_ids_by_cve_id(self, cve_id):
        at_ids_related = {}
        for object in self.__dict_file['mapping_objects']:
            if cve_id == object['capability_id']:
                if object['mapping_type'] not in at_ids_related:
                    at_ids_related[object['mapping_type']] = []
                at_ids_related[object['mapping_type']].append(object['attack_object_id'].strip()[:-1] if object['attack_object_id'].strip().endswith('.') else object['attack_object_id'].strip())
                
        return at_ids_related